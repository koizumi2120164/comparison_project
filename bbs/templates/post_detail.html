{% extends 'bbs/base.html' %}
{% load bbs %}

{% block content %}
<section class="mt-5">
  <div class="card">
    <div class="card-header">
      {% if is_user_liked_for_post %}
      <button type="button" id="ajax-like-for-post" style="border:none;background:none">
        <i class="fas fa-heart text-danger" id="like-for-post-icon"></i>
      </button>
      {% else %}
      <button type="button" id="ajax-like-for-post" style="border:none;background:none">
        <i class="far fa-heart text-danger" id="like-for-post-icon"></i>
      </button>
      {% endif %}
      <span id="like-for-post-count">{{ like_for_post_count }}</span>
      <span>件のイイね</span>
    </div>

    <div class="card-body">
      <div class="card-title">
        <h2>#{{ post.pk }} {{ post.title }}</h2>
      </div>
      <div class="card-text">
        <span class="fs-6">{{ post.created_at | date:'Y-m-d'}}</span>
        <p class="fs-6">{{ post.writer }}</p>
        <div class="mt-5">
          {{ post.text }}
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block extrajs %}
<script type="text/javascript">
  /* ポストに対するイイね */
  document.getElementById('ajax-like-for-post').addEventListener('click', e => {
    e.preventDefault();
    const url = '{% url "bbs:like_for_post" %}';
    fetch(url, {
      method: 'POST',
      body: `post_pk={{post.pk}}`,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8',
        'X-CSRFToken': '{{ csrf_token }}',
      },
    }).then(response => {
      return response.json();
    }).then(response => {
      const counter = document.getElementById('like-for-post-count')
      const icon = document.getElementById('like-for-post-icon')
      counter.textContent = response.like_for_post_count
      if (response.method == 'create') {
        icon.classList.remove('far')
        icon.classList.add('fas')
        icon.id = 'like-for-post-icon'
      } else {
        icon.classList.remove('fas')
        icon.classList.add('far')
        icon.id = 'like-for-post-icon'
      }
    }).catch(error => {
      console.log(error);
    });
  });
</script>
{% endblock %}